# go-grpc-demo

A modern Go microservice demonstrating clean architecture, gRPC, PostgreSQL integration, and containerized development.

## Features

- **gRPC API** for rocket inventory management
- **PostgreSQL** database with UUID primary keys
- **Clean architecture**: domain, transport, and data layers
- **Protocol Buffers** for type-safe API contracts
- **Docker & Docker Compose** for easy local development
- **SQL migrations** for schema management
- **Unit tests** with mocks for business logic

## Project Structure

```
go-grpc-demo/
├── cmd/server/           # Main application entrypoint
├── internal/
│   ├── db/               # Database logic (PostgreSQL, migrations)
│   ├── rocket/           # Domain model, service, and tests
│   └── transport/        # gRPC handler implementation
├── rocket/v1/            # Protobuf definitions and generated code
├── migrations/           # SQL migration files
├── Dockerfile            # Multi-stage build for production images
├── docker-compose.yml    # Service orchestration
├── README.md             # Project documentation
```

## Getting Started

### Prerequisites

- [Go](https://golang.org/doc/install) 1.24+
- [Docker](https://docs.docker.com/get-docker/)
- [Docker Compose](https://docs.docker.com/compose/install/)
- [protoc](https://grpc.io/docs/protoc-installation/) (Protocol Buffers compiler)
- [golang-migrate](https://github.com/golang-migrate/migrate) (optional, for migrations)

### Running Locally

1. **Clone the repository**

   ```bash
   git clone https://github.com/sibelephant/go-grpc-demo.git
   cd go-grpc-demo
   ```

2. **Build and start services**

   ```bash
   docker-compose up --build
   ```

   This will:

   - Start a PostgreSQL database (with UUID support)
   - Build and run the gRPC microservice

3. **Apply migrations (if needed)**

   ```bash
   # Example using golang-migrate
   migrate -path ./migrations -database "postgres://postgres:postgres@localhost:5432/postgres?sslmode=disable" up
   ```

4. **Test the gRPC API**
   - Use [BloomRPC](https://github.com/bloomrpc/bloomrpc) or [grpcurl](https://github.com/fullstorydev/grpcurl)
   - Import `rocket/v1/rocket.proto`
   - Connect to `localhost:50051`

## API Overview

### Protobuf Service

```protobuf
service RocketService {
  rpc GetRocket (GetRocketRequest) returns (GetRocketResponse);
  rpc AddRocket (AddRocketRequest) returns (AddRocketResponse);
  rpc DeleteRocket (DeleteRocketRequest) returns (DeleteRocketResponse);
}
```

### Rocket Model

- `id`: UUID (auto-generated)
- `name`: string
- `type`: string
- `flight`: integer

## Database

- **Table:** `rockets`
- **Primary Key:** `id` (UUID, generated by `uuid_generate_v4()`)
- **Migration files:** Located in `migrations/`

## Testing

- Run unit tests:

  ```bash
  go test ./internal/rocket
  ```

- Mocks are auto-generated using `mockgen`:
  ```bash
  go generate ./...
  ```

## Development Tips

- **Migrations:** Use `golang-migrate` or manual SQL for schema changes.
- **Connection retries:** The service waits for the database to be ready before starting.
- **Environment variables:** Set in `docker-compose.yml` for DB connection.
- **Protobuf changes:** After editing `.proto` files, regenerate Go code:
  ```bash
  cd rocket
  make build
  ```

## Troubleshooting

- **Database connection errors:** Ensure the database container is running and healthy.
- **UUID errors:** Make sure the `uuid-ossp` extension is enabled in PostgreSQL.
- **Migration errors:** Check migration file syntax and order.

## License

MIT

---

**Contributions welcome!**
